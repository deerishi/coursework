(function(){Aedu.SignupToDownload||(Aedu.SignupToDownload={}),Aedu.SignupToDownload.notifier=new c.Server.Notification("sutd"),Aedu.SignupToDownload.notifier.notifyAndLog=function(t,e){return null==e&&(e={}),$a.log(t),this.notify({event_type:t,attachment_id:e.attachment_id?e.attachment_id:void 0,auvid:$auvid,location:e.location?e.location:void 0,error:e.error?e.error:void 0})}}).call(this),function(){this.JST||(this.JST={}),this.JST["signup_to_download/templates/layout"]=function(t){var e,s=[],i=t||{};return function(t,i,o,n,l,a){s.push('<div class="DesignSystem"><div style="width:460px" class="modal-dialog"><div class="modal-content u-overflowHidden"><div class="modal-header container-fluid u-border0 u-p10x u-pb0x"><div class="row u-mb10x"><div class="col-xs-8 col-xs-offset-2"><div class="u-textAlignCenter u-fontSize20 u-fontWeight700 u-textColorGrayDarker">'+jade.escape(null==(e=a)?"":e)+"</div></div>"),l&&s.push('<div class="col-xs-2"><button data-dismiss="modal" class="js-close-full-modal u-floatRight Close u-fontSize24">&times;</button></div>'),s.push('</div></div><div class="modal-body container-fluid u-p10x u-pt0x"><div class="row u-mb10x"><div class="col-xs-12"><div class="u-textAlignCenter"><div style="line-height:30px" class="u-textColorGrayDark u-fontSize18 u-fontWeight400 u-fontSerif">'+jade.escape(null==(e=n)?"":e)+'</div></div></div></div><div class="row u-mb5x"><div class="col-xs-6 u-pr2x"><button id="google-signup-button" class="Button Button--google Button--block Button--lg"><i class="fa fa-google-plus fa-lg"></i>&nbsp;&nbsp;Connect</button></div><div class="col-xs-6 u-pl2x"><button id="fb-signup-button" class="Button Button--facebook Button--block Button--lg"><i class="fa fa-facebook-square fa-lg"></i>&nbsp;&nbsp;Connect</button></div></div><div class="row u-mb5x"><div class="col-xs-12"><div class="hr-heading login-hr-heading"><span class="hr-heading-text">or</span></div></div></div><form class="js-modal-title-form container-fluid"><div class="row u-mb5x"><div class="col-xs-12 u-ph0x TextInputWrapper--icon u-floatLeft"><input placeholder="Email" type="email" id="user_email" class="TextInput TextInput--xl js-modal-title-email swp-splash-single-step-singup-input"/><i class="fa fa-envelope-o u-textColorGrayDark js-modal-title-envelope"></i></div></div><div class="row"><div class="col-xs-12 collapse js-modal-title-form-collapsed"><div class="row u-mb5x"><div class="col-xs-6 u-pl0x u-pr2x"><input placeholder="First Name" id="user_first_name" class="TextInput TextInput--xl js-modal-title-first-name swp-splash-single-step-singup-input"/></div><div class="col-xs-6 u-pl2x u-pr0x"><div class="u-positionRelative"><input placeholder="Last Name" id="user_last_name" class="TextInput TextInput--xl js-modal-title-last-name swp-splash-single-step-singup-input"/></div></div></div><div class="row u-mb5x"><div class="col-xs-12 u-ph0x"><input type="password" placeholder="Password" id="user_password" class="TextInput TextInput--xl js-modal-title-password swp-splash-single-step-singup-input"/></div></div><div class="row u-mb5x"><div class="col-xs-12 u-ph0x"><button type="submit" class="js-modal-signup-submit swp-splash-signup-submit Button Button--block Button--lg Button--green">'),s.push(i?jade.escape(null==(e=i)?"":e):"<i"+jade.cls(["fa","fa-lg","pdf"===t?"fa-file-pdf-o":"fa-file-text-o"],[null,null,!0])+"></i>&nbsp;&nbsp;\nGET "+jade.escape(null==(e="pdf"===t?"PDF":"FILE")?"":e)),s.push('</button></div></div></div></div><div class="row"><div class="col-xs-12 u-ph0x u-textAlignCenter"><div class="u-fontWeight500 u-fontSize11 u-textColorGray">By signing up, you agree to our\n&nbsp;<a href="/terms" class="js-modal terms-link u-linkUnstyled u-textDecorationUnderline">terms</a>&nbsp;&bull; Already have an account?\n&nbsp;<a'+jade.attr("href",o,!0,!1)+' class="u-linkUnstyled u-textDecorationUnderline">Sign in</a></div></div></div></form></div></div></div></div>')}.call(this,"attachmentType"in i?i.attachmentType:"undefined"!=typeof attachmentType?attachmentType:void 0,"buttonText"in i?i.buttonText:"undefined"!=typeof buttonText?buttonText:void 0,"loginUrl"in i?i.loginUrl:"undefined"!=typeof loginUrl?loginUrl:void 0,"message"in i?i.message:"undefined"!=typeof message?message:void 0,"showCloseButton"in i?i.showCloseButton:"undefined"!=typeof showCloseButton?showCloseButton:void 0,"title"in i?i.title:"undefined"!=typeof title?title:void 0),s.join("")}}.call(this),function(){this.JST||(this.JST={}),this.JST["signup_to_download/templates/layout_line"]=function(t){var e,s=[],i=t||{};return function(t,i,o,n,l,a){s.push('<div class="DesignSystem"><div style="width:460px" class="modal-dialog"><div class="modal-content u-overflowHidden"><div class="modal-header container-fluid u-p0x"><div class="row u-pv6x"><div class="col-xs-8 col-xs-offset-2"><div class="u-textAlignCenter u-fontSize14 u-fontWeight700 u-textColorGrayDarkest u-textUppercase u-textLetterSpacing1">'+jade.escape(null==(e=a)?"":e)+"</div></div>"),l&&s.push('<div class="col-xs-2"><button data-dismiss="modal" class="js-close-full-modal u-floatRight Close u-fontWeight400 u-fontSize20 u-mr4x">&times;</button></div>'),s.push('</div></div><div class="modal-body container-fluid u-p10x"><div class="row u-mb10x"><div class="col-xs-12"><div class="u-textAlignCenter"><div class="u-textColorGrayDarkest u-lineHeight1_4 u-fontSerif u-fontSize22">'+jade.escape(null==(e=n)?"":e)+'</div></div></div></div><div class="row u-mb5x"><div class="col-xs-6 u-pr2x"><button id="google-signup-button" class="Button Button--google Button--block Button--lg"><i class="fa fa-google-plus fa-lg"></i>&nbsp;&nbsp;Connect</button></div><div class="col-xs-6 u-pl2x"><button id="fb-signup-button" class="Button Button--facebook Button--block Button--lg"><i class="fa fa-facebook-square fa-lg"></i>&nbsp;&nbsp;Connect</button></div></div><div class="row u-mb5x"><div class="col-xs-12"><div class="hr-heading login-hr-heading"><span class="hr-heading-text">or</span></div></div></div><form class="js-modal-title-form container-fluid"><div class="row u-mb5x"><div class="col-xs-12 u-ph0x TextInputWrapper--icon u-floatLeft"><input placeholder="Email" type="email" id="user_email" class="TextInput TextInput--xl js-modal-title-email swp-splash-single-step-singup-input"/><i class="fa fa-envelope-o u-textColorGrayDark js-modal-title-envelope"></i></div></div><div class="row"><div class="col-xs-12 collapse js-modal-title-form-collapsed"><div class="row u-mb5x"><div class="col-xs-6 u-pl0x u-pr2x"><input placeholder="First Name" id="user_first_name" class="TextInput TextInput--xl js-modal-title-first-name swp-splash-single-step-singup-input"/></div><div class="col-xs-6 u-pl2x u-pr0x"><div class="u-positionRelative"><input placeholder="Last Name" id="user_last_name" class="TextInput TextInput--xl js-modal-title-last-name swp-splash-single-step-singup-input"/></div></div></div><div class="row u-mb5x"><div class="col-xs-12 u-ph0x"><input type="password" placeholder="Password" id="user_password" class="TextInput TextInput--xl js-modal-title-password swp-splash-single-step-singup-input"/></div></div><div class="row u-mb5x"><div class="col-xs-12 u-ph0x"><button type="submit" class="js-modal-signup-submit swp-splash-signup-submit Button Button--block Button--lg Button--green">'),s.push(i?jade.escape(null==(e=i)?"":e):"<i"+jade.cls(["fa","fa-lg","pdf"===t?"fa-file-pdf-o":"fa-file-text-o"],[null,null,!0])+"></i>&nbsp;&nbsp;\nGET "+jade.escape(null==(e="pdf"===t?"PDF":"FILE")?"":e)),s.push('</button></div></div></div></div><div class="row"><div class="col-xs-12 u-ph0x u-textAlignCenter"><div class="u-fontWeight400 u-fontSize12 u-textColorGrayDark">Already have an account?\n&nbsp;<a'+jade.attr("href",o,!0,!1)+' class="u-linkUnstyled u-textDecorationUnderline u-textColorBlue">Log in</a></div></div></div></form></div></div></div></div>')}.call(this,"attachmentType"in i?i.attachmentType:"undefined"!=typeof attachmentType?attachmentType:void 0,"buttonText"in i?i.buttonText:"undefined"!=typeof buttonText?buttonText:void 0,"loginUrl"in i?i.loginUrl:"undefined"!=typeof loginUrl?loginUrl:void 0,"message"in i?i.message:"undefined"!=typeof message?message:void 0,"showCloseButton"in i?i.showCloseButton:"undefined"!=typeof showCloseButton?showCloseButton:void 0,"title"in i?i.title:"undefined"!=typeof title?title:void 0),s.join("")}}.call(this),function(){Aedu.SignupToDownload.Layout=Backbone.View.extend({template:"signup_to_download/templates/layout",template_line:"signup_to_download/templates/layout_line",className:"modal fade",events:{"focus .js-modal-title-email":"expandEmailForm","click .js-modal-signup-submit":"submitSignup","click .js-modal-terms-link":"termsClicked","keydown .js-modal-title-first-name":"logTyping","keydown .js-modal-title-last-name":"logTyping","keydown .js-modal-title-password":"logTyping","keydown .js-modal-title-email":"logTyping"},initialize:function(t){return null==t&&(t={}),this.model=new MobileRegPath.newUser({attachment_id:t.attachmentId,login_redirect:t.loginRedirect,user_source:t.userSource}),this.ab_test=t.ab_test||"no_line",this.data={loginUrl:t.loginUrl||"/login",message:t.message,attachmentType:null!=t.attachmentType?t.attachmentType:void 0,title:t.title,buttonText:t.buttonText,showCloseButton:t.showCloseButton},this.log={user_email:!1,user_first_name:!1,user_last_name:!1,user_password:!1},this.render(this.data)},render:function(t){return this.$el.html("no_line"===this.ab_test?JST[this.template](t):JST[this.template_line](t)),this.postRender()},postRender:function(){return this.ui={$emailForm:this.$(".js-modal-title-form-collapsed"),$googleButton:this.$("#google-signup-button"),$facebookButton:this.$("#fb-signup-button"),$firstName:this.$(".js-modal-title-first-name"),$lastName:this.$(".js-modal-title-last-name"),$password:this.$(".js-modal-title-password"),$email:this.$(".js-modal-title-email"),$envelope:this.$(".js-modal-title-envelope")},new Academia.Auth.OauthButton.Connect.Facebook({el:this.ui.$facebookButton,track:!0,registrationParams:{doc_id:this.model.get("attachment_id")}}),new Academia.Auth.OauthButton.Connect.Google({el:this.ui.$googleButton,track:!0,registrationParams:{doc_id:this.model.get("attachment_id")}}),this.$el.modal({backdrop:"static",keyboard:!1}),this.$el.on("hidden.bs.modal",function(){return Aedu.SignupToDownload.notifier.notifyAndLog("download_closed")})},expandEmailForm:function(){return this.ui.$emailForm.collapse("show")},submitSignup:function(t){return t.preventDefault(),Aedu.SignupToDownload.notifier.notifyAndLog("attempted_submit"),this.saveFields(),this.model.savingToServer?void 0:this.model.save().done(function(t){return function(e){var s,i,o;return o=e[0],s=e[1],i=e[2],o?window.location.replace(s.redirect):(Aedu.SignupToDownload.notifier.notifyAndLog("validation_failure",{error:JSON.stringify(i)}),t.displayErrors(i))}}(this)).fail(function(){return alert("Something went wrong")})},saveFields:function(){return this.model.set({email:this.ui.$email.val(),first_name:this.ui.$firstName.val(),last_name:this.ui.$lastName.val(),password:this.ui.$password.val()})},renderErrorHTML:function(t){return"<div class='js-swp-splash-input-inner-error swp-splash-input-inner-error u-textColorRed a-fadeInDownShort'>"+t+"</div>"},displayErrors:function(t){var e;return e=$(this.ui.$firstName).add(this.ui.$lastName).add(this.ui.$password).add(this.ui.$email),e.removeClass("TextInput--error").css({"padding-top":0}),this.ui.$envelope.css({"padding-top":0}),this.$(".js-swp-splash-input-inner-error").remove(),_.each(t,function(t){return function(e){var s,i;return i=e[0],s=e[1],"user[email]"===i&&t.showErrorForEmail(t.ui.$email,s),"user[first_name]"===i&&t.showErrorForInput(t.ui.$firstName,s),"user[last_name]"===i&&t.showErrorForInput(t.ui.$lastName,s),"user[password]"===i?t.showErrorForInput(t.ui.$password,s):void 0}}(this))},showErrorForInput:function(t,e){return t.addClass("TextInput--error").after(this.renderErrorHTML(e.replace(/\./g,""))).css({"padding-top":10})},showErrorForEmail:function(t,e){return t.addClass("TextInput--error").css({"padding-top":10}),this.ui.$envelope.after(this.renderErrorHTML(e.replace(/\./g,""))).css({"padding-top":5})},termsClicked:function(){return Aedu.SignupToDownload.notifier.notifyAndLog("terms",{auvid:$auvid})},logTyping:function(t){return this.log[t.target.id]?void 0:(Aedu.SignupToDownload.notifier.notifyAndLog("started_typing",{location:t.target.id}),this.log[t.target.id]=!0)}})}.call(this);